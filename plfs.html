<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PLFS | Command Dashboard 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- SheetJS -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
/* (UI kept same â€“ trimmed here for focus) */
body{margin:0;background:#020617;color:#fff;font-family:'Plus Jakarta Sans'}
.left-rail{position:fixed;left:0;top:0;width:72px;height:100vh;background:#0f172a}
.app-shell{margin-left:72px;height:100vh;display:flex}
.sidebar{width:300px;background:#0f172a;border-right:1px solid #334155}
.main{flex:1;display:flex;flex-direction:column}
.workspace{flex:1;overflow:auto;padding:20px}
</style>
</head>

<body>

<nav class="left-rail">
  <a href="index.html">ğŸ </a>
  <a href="plfs.html">ğŸ“Š</a>
  <a href="ufs_weekly.html">ğŸ—“ï¸</a>
</nav>

<div class="app-shell">

<aside class="sidebar">
  <div id="navScroll"></div>
</aside>

<main class="main">
  <div class="workspace">
    <table border="1" width="100%">
      <thead><tr id="tableHeader"></tr></thead>
      <tbody id="dataBody"></tbody>
    </table>
  </div>
</main>

</div>

<script>
/* ğŸ”¹ FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyB6fQ8n4qyG-TfVdAqWtDped17bMYTZSgI",
  databaseURL:"https://action-plan-62fae-default-rtdb.firebaseio.com"
});
const db=firebase.database();

/* ğŸ”¹ ORIGINAL STATE VARIABLES */
let master=[];
let selSt="HIMACHAL PRADESH";
let selSro="ALL SROs";
let selMo=0;
let selVis=1;
let query="";

const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

/* ğŸ”¹ ORIGINAL NAV LOGIC (GLOBAL â€“ FIXED) */
function renderNav(){
  const c=document.getElementById("navScroll");
  if(!master.length){
    c.innerHTML="No data";
    return;
  }

  const sros=[...new Set(master.map(x=>x.sro))].sort();
  let h=`<b>SRO OFFICES</b><br>`;
  h+=`<div onclick="selSro='ALL SROs';refresh()">ALL</div>`;
  sros.forEach(s=>{
    h+=`<div onclick="selSro='${s}';refresh()">${s}</div>`;
  });

  h+=`<hr><b>MONTH</b><br>`;
  months.forEach((m,i)=>{
    h+=`<span onclick="selMo=${i};refresh()">${m}</span> `;
  });

  c.innerHTML=h;
}

/* ğŸ”¹ ORIGINAL TABLE LOGIC */
function refresh(){
  const body=document.getElementById("dataBody");
  body.innerHTML="";

  master.filter(d=>{
    return (selSro==="ALL SROs"||d.sro===selSro) &&
           d.monthIdx===selMo &&
           (d.fsu+d.location).toLowerCase().includes(query);
  }).forEach(d=>{
    body.innerHTML+=`
      <tr>
        <td>${d.fsu}</td>
        <td>${d.location}</td>
        <td>${d.visitNum}</td>
      </tr>`;
  });
}

/* ğŸ”¹ ORIGINAL EXCEL IMPORT (FIXED BRACES ONLY) */
async function handleExcel(input){
  const file=input.files[0];
  if(!file) return;

  const data=new Uint8Array(await file.arrayBuffer());
  const wb=XLSX.read(data,{type:"array"});
  const ws=wb.Sheets[wb.SheetNames[0]];
  const rows=XLSX.utils.sheet_to_json(ws,{header:1,range:7});

  rows.slice(1).forEach(cols=>{
    let fsu=cols[4], mCode=cols[5], sro=cols[6], loc=cols[10];
    if(fsu){
      const startM=(parseInt(mCode)-1);
      for(let i=0;i<4;i++){
        master.push({
          fsu, sro, location:loc||"",
          visitNum:i+1,
          monthIdx:(startM+i)%12
        });
      }
    }
  });

  renderNav();
  refresh();
}

/* ğŸ”¹ ORIGINAL FIREBASE LOAD */
async function autoFetch(){
  const snap=await db.ref("plfs_roster/HIMACHAL PRADESH").once("value");
  master=[];
  if(snap.exists()){
    Object.values(snap.val()).forEach(v=>master.push(v));
  }
  renderNav();
  refresh();
}

/* ğŸ”¹ BOOT */
window.onload=autoFetch;
</script>

</body>
</html>

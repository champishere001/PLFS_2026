<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TA / DA Calculation Sheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

<style>
@page{ size:A4 landscape; margin:10mm; }

*{ box-sizing:border-box }
body{
  margin:0; padding:14px;
  background:#f3f5f7;
  font-family: Arial, Helvetica, sans-serif;
}
.sheet{
  background:#fff;
  border:1px solid #cfd6df;
  padding:12px;
}
.title{
  text-align:center;
  font-weight:800;
  font-size:15px;
  margin-bottom:8px;
}
.meta{
  display:grid;
  grid-template-columns:1.2fr 1fr 1fr 1fr 0.7fr;
  gap:6px;
  margin-bottom:8px;
}
.field{
  border:1px solid #000;
  padding:5px 6px;
  display:flex;
  gap:6px;
  align-items:center;
}
.label{ font-weight:700; font-size:12px; white-space:nowrap }
.input,.select{
  width:100%;
  border:none;
  outline:none;
  font-size:12px;
  background:transparent;
}

.controls{
  margin:8px 0;
  display:flex;
  gap:6px;
}
button{
  padding:6px 10px;
  font-size:12px;
  font-weight:700;
  cursor:pointer;
}

table{
  width:100%;
  border-collapse:collapse;
  table-layout:fixed;
  font-size:11px;
}
th,td{
  border:1px solid #000;
  padding:4px 5px;
  text-align:center;
  vertical-align:middle;
}
th{ font-weight:800; }
.colnum th{ font-weight:700; background:#fff; }

td input, td select{
  width:100%;
  border:none;
  outline:none;
  font-size:11px;
  background:transparent;
  text-align:center;
}
.ro{ font-weight:800 }

tfoot td{ font-weight:900 }

@media print{
  body{ background:#fff; padding:0 }
  .controls{ display:none }
}
</style>
</head>

<body>
<div class="sheet">

<div class="title">
  दौरा भत्ता / दैनिक भत्ता गणना शीट @ TA / DA CALCULATION SHEET
</div>

<!-- HEADER -->
<div class="meta">
  <div class="field"><span class="label">नाम/Name-</span><input class="input"></div>

  <div class="field">
    <span class="label">पदनाम/Designation-</span>
    <select class="select">
      <option value=""></option>
      <option>Senior Statistical Officer</option>
      <option>Survey Supervisor</option>
      <option>Survey Enumerator</option>
    </select>
  </div>

  <div class="field"><span class="label">स्थान/Place-</span><input class="input"></div>
  <div class="field"><span class="label">माह/Month-</span><input class="input"></div>
  <div class="field"><span class="label">वर्ष/Year-</span><input class="input"></div>
</div>

<div class="controls">
  <button onclick="addRow()">+ Row</button>
  <button onclick="print()">Generate PDF</button>
  <button onclick="exportExcel()">Export Excel</button>
</div>

<table id="tbl">
<thead>
<tr>
  <th rowspan="3">Date</th>
  <th rowspan="3">No. of DA</th>
  <th colspan="3">DA Details</th>
  <th colspan="3">Travelling Details</th>
  <th rowspan="3">Total<br>(5+8)</th>
</tr>
<tr>
  <th>DA</th>
  <th>Hotel</th>
  <th>Total DA<br>(3+4)</th>
  <th>Mode</th>
  <th>KM</th>
  <th>Total Fare</th>
</tr>
<tr class="colnum">
  <th>1</th><th>2</th><th>3</th><th>4</th>
  <th>5</th><th>6</th><th>7</th><th>8</th><th>9</th>
</tr>
</thead>

<tbody id="body"></tbody>

<tfoot>
<tr>
  <td colspan="1">Grand Total</td>
  <td id="g_daCnt"></td>
  <td></td>
  <td></td>
  <td id="g_da"></td>
  <td></td>
  <td></td>
  <td id="g_fare"></td>
  <td id="g_total"></td>
</tr>
</tfoot>
</table>

<div style="margin-top:14px; font-size:12px">
  दिनांक: _____________
  <span style="float:right">संबन्धित क्षेत्र कर्मचारी के हस्ताक्षर</span>
</div>

</div>

<script>
function val(x){ return x==="" ? "" : Number(x)||0 }

function addRow(){
  body.insertAdjacentHTML("beforeend",`
  <tr>
    <td><input></td>
    <td><input type="number" oninput="calc(this)"></td>
    <td><input type="number" oninput="calc(this)"></td>
    <td><input type="number" oninput="calc(this)"></td>
    <td class="ro totalDA"></td>
    <td><input></td>
    <td><input type="number"></td>
    <td><input type="number" oninput="calc(this)"></td>
    <td class="ro grand"></td>
  </tr>`);
}

function calc(el){
  const tr = el.closest("tr");
  const cnt = val(tr.cells[1].firstChild.value);
  const da  = val(tr.cells[2].firstChild.value);
  const h   = val(tr.cells[3].firstChild.value);
  const fare= val(tr.cells[7].firstChild.value);

  const totalDA = (cnt && da) ? (cnt*da + h) : "";
  const grand   = (totalDA!=="" && fare!=="") ? (totalDA+fare) : "";

  tr.querySelector(".totalDA").textContent = totalDA;
  tr.querySelector(".grand").textContent = grand;

  totals();
}

function totals(){
  let daCnt=0, da=0, fare=0, tot=0;
  document.querySelectorAll("#body tr").forEach(tr=>{
    daCnt += val(tr.cells[1].firstChild.value);
    da += val(tr.querySelector(".totalDA").textContent);
    fare += val(tr.cells[7].firstChild.value);
    tot += val(tr.querySelector(".grand").textContent);
  });
  g_daCnt.textContent = daCnt||"";
  g_da.textContent = da||"";
  g_fare.textContent = fare||"";
  g_total.textContent = tot||"";
}

function exportExcel(){
  const wb = XLSX.utils.book_new();
  const data=[["TA/DA Sheet"]];
  document.querySelectorAll("tr").forEach(r=>{
    data.push([...r.cells].map(c=>c.innerText||c.querySelector("input,select")?.value||""));
  });
  XLSX.utils.book_append_sheet(wb,XLSX.utils.aoa_to_sheet(data),"TA_DA");
  XLSX.writeFile(wb,"TA_DA.xlsx");
}

addRow();
</script>
</body>
</html>
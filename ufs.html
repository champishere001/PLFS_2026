<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover" />
  <title>UFS | Weekly Progress Report (SRO console)</title>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#020617; --sb:#0f172a; --card:#0b1220; --border:#334155;
      --accent:#38bdf8; --ok:#10b981; --text:#f8fafc; --dim:#94a3b8;
      --warn:#f59e0b; --danger:#ef4444;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:'Plus Jakarta Sans',sans-serif; background:var(--bg); color:var(--text); height:100vh; height:100dvh; overflow:hidden; }
    .app{ height:100%; display:flex; overflow:hidden; }

    aside{
      width:380px; min-width:380px;
      background:var(--sb);
      border-right:1px solid var(--border);
      display:flex; flex-direction:column;
    }
    .sb-head{
      padding:16px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .sb-head b{ color:var(--accent); letter-spacing:1px; }
    .sb-head .sub{ margin-top:6px; font-size:11px; color:rgba(248,250,252,.70); font-weight:700; line-height:1.35; }

    .sb-body{ padding:14px 16px 16px; overflow:auto; display:grid; gap:12px; }
    .card{
      background:rgba(30,41,59,.35);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:12px;
      box-shadow:0 14px 36px rgba(0,0,0,.25);
    }
    .card h3{ margin:0 0 10px; font-size:12px; font-weight:1000; letter-spacing:.8px; text-transform:uppercase; color:rgba(248,250,252,.92); }
    .muted{ font-size:11px; color:rgba(248,250,252,.65); font-weight:700; line-height:1.45; }

    .input, select{
      width:100%;
      background:#000;
      border:1px solid rgba(255,255,255,.12);
      color:#fff;
      padding:10px;
      border-radius:10px;
      outline:none;
      font-weight:900;
      font-size:12px;
    }
    .btn{
      border:none; border-radius:10px;
      padding:10px 12px;
      font-weight:1000; cursor:pointer; font-size:12px;
    }
    .btn-soft{ background:rgba(255,255,255,.10); color:#fff; border:1px solid rgba(255,255,255,.12); }
    .btn-accent{ background:var(--accent); color:#000; }
    .btn-ok{ background:var(--ok); color:#000; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.22);
      color:rgba(248,250,252,.85);
      font-size:11px; font-weight:1000;
    }
    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }

    main{ flex:1; display:flex; flex-direction:column; overflow:hidden; }
    header{
      padding:12px 16px;
      background:rgba(15,23,42,.92);
      border-bottom:1px solid var(--border);
      display:flex; align-items:center; gap:10px;
    }
    header .title{ font-weight:1000; letter-spacing:1px; color:var(--accent); }
    header .grow{ flex:1; }
    header input[type="date"]{ color-scheme:dark; }

    .workspace{ flex:1; padding:14px 16px 18px; overflow:auto; }
    .panel{
      background:rgba(30,41,59,.25);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:12px;
      box-shadow:0 16px 44px rgba(0,0,0,.35);
    }
    .report-title{
      font-weight:1000; color:#fff;
      padding:10px 10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .report-title span{ color:rgba(248,250,252,.75); font-weight:800; font-size:12px; }

    .table-wrap{
      margin-top:12px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      overflow:auto;
    }
    table{ width:100%; border-collapse:separate; border-spacing:0; min-width:1200px; }
    th{
      position:sticky; top:0; z-index:10;
      background:#0b1220;
      color:var(--accent);
      font-size:11px;
      text-transform:uppercase;
      font-weight:1000;
      letter-spacing:.7px;
      padding:12px 10px;
      border-bottom:2px solid rgba(56,189,248,.55);
      text-align:left;
      white-space:nowrap;
    }
    td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      color:rgba(248,250,252,.85);
      font-size:12px;
      vertical-align:middle;
      white-space:nowrap;
    }
    .num{ text-align:right; font-variant-numeric: tabular-nums; }
    .sro{ font-weight:1000; }
    .total-row td{ font-weight:1000; color:#fff; background:rgba(0,0,0,.25); }
    .mark-edit{ border-left:3px solid var(--ok); padding-left:8px; }

    .console-grid{
      display:grid; gap:10px;
      grid-template-columns:1fr 1fr;
    }
    .field{
      background:rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      padding:10px;
    }
    .field label{
      display:block;
      font-size:10px;
      font-weight:1000;
      letter-spacing:.7px;
      text-transform:uppercase;
      color:rgba(248,250,252,.70);
      margin-bottom:6px;
    }
    .field input{
      width:100%;
      background:#000;
      border:1px solid rgba(16,185,129,.40);
      color:#fff;
      padding:10px;
      border-radius:10px;
      outline:none;
      font-weight:1000;
      font-size:12px;
    }
    .help{
      margin-top:10px;
      font-size:11px;
      color:rgba(248,250,252,.65);
      font-weight:700;
      line-height:1.45;
    }

    #loading{
      display:none; position:fixed; inset:0;
      background:rgba(2,6,23,.92);
      z-index:9999;
      align-items:center; justify-content:center;
      flex-direction:column;
      color:var(--accent);
    }
    .spin{
      width:42px; height:42px;
      border:4px solid rgba(56,189,248,.16);
      border-left-color:var(--accent);
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin-bottom:12px;
    }
    @keyframes spin{ to{ transform:rotate(360deg); } }
  </style>
</head>
<body>

<div id="loading">
  <div class="spin"></div>
  <div id="loadingText" style="font-weight:1000; letter-spacing:2px; font-size:12px;">LOADING...</div>
</div>

<div class="app">
  <!-- LEFT -->
  <aside>
    <div class="sb-head">
      <div>
        <b>UFS WEEKLY ‚Üí MONTHLY</b>
        <div class="sub">SRO-wise | Week-wise ‚ÄúDuring‚Äù editable<br>Base values from XLSX (loaded once)</div>
      </div>
      <button class="btn btn-soft" onclick="reloadAll()">‚Üª</button>
    </div>

    <div class="sb-body">
      <div class="card">
        <h3>Files (same folder)</h3>
        <div class="muted">
          Put in same folder as this HTML:
          <br><b>Weekly MPR RO Shimla Level.xlsx</b>
          <br><b>UFS MPR Monthly RO Shimla.xlsx</b> (optional)
        </div>
      </div>

      <div class="card">
        <h3>Week + SRO</h3>
        <div class="grid2">
          <div>
            <div class="muted">Week Start</div>
            <input id="wkStart" class="input" type="date" />
          </div>
          <div>
            <div class="muted">Week End (as on)</div>
            <input id="wkEnd" class="input" type="date" />
          </div>
        </div>
        <div style="height:8px"></div>
        <div class="muted">Select SRO</div>
        <select id="sroSelect" class="input" onchange="selectSro(this.value)">
          <option value="">-- Select SRO --</option>
          <option value="Shimla">Shimla</option>
          <option value="Hamirpur">Hamirpur</option>
          <option value="Dharamshala">Dharamshala</option>
          <option value="Mandi">Mandi</option>
        </select>
        <div style="height:8px"></div>
        <div class="pill" id="pill">SRO: Not selected</div>
      </div>

      <div class="card" id="consoleCard" style="display:none;">
        <h3>Data Entry Console (During week)</h3>
        <div class="console-grid" id="consoleGrid"></div>
        <div class="help">
          ‚úÖ Only these ‚ÄúDuring ‚Ä¶‚Äù fields are editable for selected SRO & week.<br>
          üîí ‚ÄúSince Start / Completed Since Start / Under Survey / %‚Äù stay base (read-only).
        </div>
        <div style="height:10px"></div>
        <button class="btn btn-ok" onclick="saveConsole()">üíæ Save (Firebase)</button>
      </div>

      <div class="card">
        <h3>Actions</h3>
        <button class="btn btn-accent" style="width:100%;" onclick="reloadAll()">Reload base XLSX</button>
      </div>
    </div>
  </aside>

  <!-- RIGHT -->
  <main>
    <header>
      <div class="title">Weekly Progress Report</div>
      <div class="grow"></div>
      <button class="btn btn-soft" onclick="clearSro()">Clear SRO</button>
    </header>

    <div class="workspace">
      <div class="panel">
        <div class="report-title" id="reportTitle">
          WEEKLY PROGRESS REPORT <span>(select week dates)</span>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr id="thead"></tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
/* =======================
   CONFIG
======================= */
const STATE_NAME = "HIMACHAL PRADESH";
const WEEKLY_XLSX_URL = "Weekly MPR RO Shimla Level.xlsx"; // base file (load once)

const firebaseConfig = {
  apiKey: "AIzaSyB6fQ8n4qyG-TfVdAqWtDped17bMYTZSgI",
  authDomain: "action-plan-62fae.firebaseapp.com",
  databaseURL: "https://action-plan-62fae-default-rtdb.firebaseio.com",
  projectId: "action-plan-62fae"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* =======================
   STATE
======================= */
const SROS = ["Shimla","Hamirpur","Dharamshala","Mandi"];
let baseLoaded = false;

let baseBySro = {};   // base snapshot from XLSX (since start etc.)
let editsBySro = {};  // current week edits (during values)
let selectedSro = "";

const FIELDS = [
  { key:"allotted", label:"Allotted Towns", ro:true },
  { key:"townsDuring", label:"Towns in field (During week)", ro:false, during:true },
  { key:"completedSince", label:"Completed Since Start", ro:true },
  { key:"underSurvey", label:"Under Survey", ro:true },
  { key:"pct", label:"% Towns Completed", ro:true },
  { key:"blocksDuring", label:"Blocks formed (During week)", ro:false, during:true },
  { key:"blocksSince", label:"Blocks formed Since Start", ro:true },
  { key:"townsAllRespectDuring", label:"Towns completed (all respect) During week", ro:false, during:true },
  { key:"townsAllRespectSince", label:"Towns completed (all respect) Since Start", ro:true },
  { key:"dispatchDuring", label:"Towns dispatched to HQ (During week)", ro:false, during:true },
  { key:"dispatchSince", label:"Towns dispatched to HQ (Since Start)", ro:true },
];

/* =======================
   LOADER
======================= */
function toggleLoader(show, text="PLEASE WAIT..."){
  const el = document.getElementById("loading");
  document.getElementById("loadingText").innerText = text;
  el.style.display = show ? "flex" : "none";
}
function n(x){
  const t = (x ?? "").toString().replace(/[%\s,]/g,"").trim();
  if(!t) return 0;
  const v = Number(t);
  return Number.isFinite(v) ? v : 0;
}

/* =======================
   XLSX read with merges
======================= */
function sheetToGridWithMerges(wb, sheetName){
  const ws = wb.Sheets[sheetName];
  const grid = XLSX.utils.sheet_to_json(ws, { header: 1, raw: true, defval: "" });
  const merges = ws["!merges"] || [];
  for (const m of merges) {
    const topLeft = (grid[m.s.r] && grid[m.s.r][m.s.c]) ?? "";
    for (let r = m.s.r; r <= m.e.r; r++) {
      if (!grid[r]) grid[r] = [];
      for (let c = m.s.c; c <= m.e.c; c++) {
        if (grid[r][c] === "" || grid[r][c] === null || typeof grid[r][c] === "undefined") {
          grid[r][c] = topLeft;
        }
      }
    }
  }
  return grid;
}

async function fetchArrayBuffer(url){
  const res = await fetch(url, { cache:"no-store" });
  if(!res.ok) throw new Error("File not found: " + url);
  return await res.arrayBuffer();
}

/* =======================
   Parse weekly base XLSX
   We pick columns by index based on your provided table (col numbers 1..27)
   but we ONLY need subset for the shared report.
======================= */
function parseBaseFromGrid(grid){
  // We search for rows whose first cell is one of SRO names
  // and then use fixed positions from your monthly sheet:
  // 2 SRO, 3 allotted towns, 6 CompletedDuringMonth (base; but will be replaced by weekly edits)
  // 7 CompletedSinceStart, 8 UnderSurvey, 9 pct,
  // 10 BlocksDuringMonth, 11 BlocksSinceStart,
  // 24 towns completed all respect during, 25 since,
  // 26 dispatched during, 27 since
  // NOTE: In your screenshot/table, SRO is in column 1 (first cell of row) and RO office in col 2.
  // We will use your SAMPLE text: row begins with "Shimla" then "Shimla" then values...

  const bySro = {};
  for(const r of grid){
    const sro = (r[0] ?? "").toString().trim();
    if(!SROS.includes(sro)) continue;

    bySro[sro] = {
      sro,
      // from your sample:
      allotted: n(r[2]),
      // during fields base default (0 if empty) ‚Äì editable later
      townsDuring: n(r[5]),              // CompletedDuring Month (we treat as during-week placeholder)
      blocksDuring: n(r[9]),             // Blocks during month
      townsAllRespectDuring: n(r[23]),   // col 24 (0-index 23)
      dispatchDuring: n(r[25]),          // col 26 (0-index 25)

      // read-only base snapshots
      completedSince: n(r[6]),
      underSurvey: n(r[7]),
      pct: n(r[8]),
      blocksSince: n(r[10]),
      townsAllRespectSince: n(r[24]),
      dispatchSince: n(r[26]),
    };
  }

  // ensure all sros exist
  for(const s of SROS){
    bySro[s] ||= {
      sro:s, allotted:0, townsDuring:0, completedSince:0, underSurvey:0, pct:0,
      blocksDuring:0, blocksSince:0,
      townsAllRespectDuring:0, townsAllRespectSince:0,
      dispatchDuring:0, dispatchSince:0,
    };
  }
  return bySro;
}

/* =======================
   Firebase week edits
======================= */
function weekKey(){
  const a = document.getElementById("wkStart").value;
  const b = document.getElementById("wkEnd").value;
  if(!a || !b) return "";
  return `${a}_to_${b}`;
}

async function loadWeekEdits(){
  editsBySro = {};
  const wk = weekKey();
  if(!wk) return;

  toggleLoader(true, "LOADING WEEK EDITS...");
  try{
    const snap = await db.ref(`ufs_weekly_console_edits/${STATE_NAME}/${wk}`).once("value");
    if(!snap.exists()) return;
    snap.forEach(sroNode=>{
      editsBySro[sroNode.key] = sroNode.val() || {};
    });
  } finally {
    toggleLoader(false);
  }
}

/* =======================
   UI: Console
======================= */
function selectSro(val){
  selectedSro = (val || "").trim();
  document.getElementById("pill").innerText = selectedSro ? `SRO: ${selectedSro}` : "SRO: Not selected";
  document.getElementById("consoleCard").style.display = selectedSro ? "block" : "none";
  renderConsole();
  renderTable();
}

function clearSro(){
  selectedSro = "";
  document.getElementById("sroSelect").value = "";
  selectSro("");
}

function renderConsole(){
  const box = document.getElementById("consoleGrid");
  if(!selectedSro){ box.innerHTML = ""; return; }

  const base = baseBySro[selectedSro] || {};
  const edits = editsBySro[selectedSro] || {};
  const duringKeys = ["townsDuring","blocksDuring","townsAllRespectDuring","dispatchDuring"];

  box.innerHTML = duringKeys.map(k=>{
    const f = FIELDS.find(x=>x.key===k);
    const cur = (k in edits) ? edits[k] : (base[k] ?? 0);
    return `
      <div class="field">
        <label>${f.label}</label>
        <input type="number" min="0" step="1" id="ed_${k}" value="${cur}">
      </div>
    `;
  }).join("");
}

async function saveConsole(){
  if(!selectedSro) return alert("Select SRO first.");
  const wk = weekKey();
  if(!wk) return alert("Select Week Start and Week End dates.");

  const payload = {
    townsDuring: n(document.getElementById("ed_townsDuring").value),
    blocksDuring: n(document.getElementById("ed_blocksDuring").value),
    townsAllRespectDuring: n(document.getElementById("ed_townsAllRespectDuring").value),
    dispatchDuring: n(document.getElementById("ed_dispatchDuring").value),
    updatedAt: Date.now()
  };

  toggleLoader(true, "SAVING...");
  try{
    await db.ref(`ufs_weekly_console_edits/${STATE_NAME}/${wk}/${selectedSro}`).set(payload);
    editsBySro[selectedSro] = payload;
    renderTable();
    alert("Saved.");
  } finally {
    toggleLoader(false);
  }
}

/* =======================
   Table render (shared weekly progress report)
======================= */
function reportTitle(){
  const a = document.getElementById("wkStart").value;
  const b = document.getElementById("wkEnd").value;
  if(!a || !b) return "WEEKLY PROGRESS REPORT (select week dates)";
  const asOn = b;
  return `WEEKLY PROGRESS REPORT (${fmtDate(a)} - ${fmtDate(b)}) as on ${fmtDate(asOn)}`;
}
function fmtDate(iso){
  // iso yyyy-mm-dd -> 30th January 2026 style (simple)
  try{
    const d = new Date(iso);
    const day = d.getDate();
    const suf = (day%10===1 && day!==11) ? "st" : (day%10===2 && day!==12) ? "nd" : (day%10===3 && day!==13) ? "rd" : "th";
    const month = d.toLocaleString("en",{month:"long"});
    const year = d.getFullYear();
    return `${day}${suf} ${month} ${year}`;
  } catch { return iso; }
}

function mergedRowForSro(sro){
  const base = baseBySro[sro] || {};
  const edits = editsBySro[sro] || {};
  return {
    sro,
    allotted: base.allotted ?? 0,
    townsDuring: (edits.townsDuring ?? base.townsDuring ?? 0),
    completedSince: base.completedSince ?? 0,
    underSurvey: base.underSurvey ?? 0,
    pct: base.pct ?? 0,
    blocksDuring: (edits.blocksDuring ?? base.blocksDuring ?? 0),
    blocksSince: base.blocksSince ?? 0,
    townsAllRespectDuring: (edits.townsAllRespectDuring ?? base.townsAllRespectDuring ?? 0),
    townsAllRespectSince: base.townsAllRespectSince ?? 0,
    dispatchDuring: (edits.dispatchDuring ?? base.dispatchDuring ?? 0),
    dispatchSince: base.dispatchSince ?? 0
  };
}

function renderTable(){
  document.getElementById("reportTitle").innerText = reportTitle();

  const cols = [
    {k:"sn", t:"Sl. No."},
    {k:"sro", t:"SRO"},
    {k:"allotted", t:"Alloted towns"},
    {k:"townsDuring", t:"Towns in field (During week)"},
    {k:"completedSince", t:"Completed Since Start"},
    {k:"underSurvey", t:"Under Survey"},
    {k:"pct", t:"% Towns Completed"},
    {k:"blocksDuring", t:"Blocks formed in field (During week)"},
    {k:"blocksSince", t:"Blocks formed Since Start"},
    {k:"townsAllRespectDuring", t:"Towns completed in all respect (During week)"},
    {k:"townsAllRespectSince", t:"Towns completed in all respect Since Start"},
    {k:"dispatchDuring", t:"Towns dispatched to HQ (During week)"},
    {k:"dispatchSince", t:"Towns dispatched to HQ Since Start"}
  ];

  document.getElementById("thead").innerHTML = cols.map(c=>`<th>${c.t}</th>`).join("");

  const rows = SROS.map((sro, i)=>{
    const r = mergedRowForSro(sro);
    const isSel = selectedSro === sro;
    const editMark = (k)=> (isSel && ["townsDuring","blocksDuring","townsAllRespectDuring","dispatchDuring"].includes(k)) ? "mark-edit" : "";
    return `
      <tr>
        <td class="num">${i+1}</td>
        <td class="sro">${sro}</td>
        <td class="num">${r.allotted}</td>
        <td class="num ${editMark("townsDuring")}">${r.townsDuring}</td>
        <td class="num">${r.completedSince}</td>
        <td class="num">${r.underSurvey}</td>
        <td class="num">${r.pct}</td>
        <td class="num ${editMark("blocksDuring")}">${r.blocksDuring}</td>
        <td class="num">${r.blocksSince}</td>
        <td class="num ${editMark("townsAllRespectDuring")}">${r.townsAllRespectDuring}</td>
        <td class="num">${r.townsAllRespectSince}</td>
        <td class="num ${editMark("dispatchDuring")}">${r.dispatchDuring}</td>
        <td class="num">${r.dispatchSince}</td>
      </tr>
    `;
  });

  // total row
  const tot = SROS.reduce((a, s)=>{
    const r = mergedRowForSro(s);
    a.allotted += r.allotted;
    a.townsDuring += r.townsDuring;
    a.completedSince += r.completedSince;
    a.underSurvey += r.underSurvey;
    a.blocksDuring += r.blocksDuring;
    a.blocksSince += r.blocksSince;
    a.townsAllRespectDuring += r.townsAllRespectDuring;
    a.townsAllRespectSince += r.townsAllRespectSince;
    a.dispatchDuring += r.dispatchDuring;
    a.dispatchSince += r.dispatchSince;
    return a;
  }, {allotted:0,townsDuring:0,completedSince:0,underSurvey:0,blocksDuring:0,blocksSince:0,townsAllRespectDuring:0,townsAllRespectSince:0,dispatchDuring:0,dispatchSince:0});

  const pctTotal = tot.allotted ? ((tot.completedSince/tot.allotted)*100) : 0;
  const pctShow = Math.round(pctTotal*100)/100;

  rows.push(`
    <tr class="total-row">
      <td></td>
      <td>Total</td>
      <td class="num">${tot.allotted}</td>
      <td class="num">${tot.townsDuring}</td>
      <td class="num">${tot.completedSince}</td>
      <td class="num">${tot.underSurvey}</td>
      <td class="num">${pctShow}</td>
      <td class="num">${tot.blocksDuring}</td>
      <td class="num">${tot.blocksSince}</td>
      <td class="num">${tot.townsAllRespectDuring}</td>
      <td class="num">${tot.townsAllRespectSince}</td>
      <td class="num">${tot.dispatchDuring}</td>
      <td class="num">${tot.dispatchSince}</td>
    </tr>
  `);

  document.getElementById("tbody").innerHTML = rows.join("");
}

/* =======================
   Load base ONCE
======================= */
async function loadBaseOnce(){
  if(baseLoaded) return;

  toggleLoader(true, "LOADING BASE XLSX...");
  try{
    const wb = XLSX.read(await fetchArrayBuffer(WEEKLY_XLSX_URL), { type:"array" });
    const sheet = wb.SheetNames[0];
    const grid = sheetToGridWithMerges(wb, sheet);
    baseBySro = parseBaseFromGrid(grid);
    baseLoaded = true;
  } finally {
    toggleLoader(false);
  }
}

/* =======================
   Main reload
   - DOES NOT refetch repeatedly unless you press reload button
======================= */
async function reloadAll(){
  await loadBaseOnce();      // base snapshot
  await loadWeekEdits();     // week edits from firebase
  renderConsole();
  renderTable();
}

/* When week dates change: only reload edits (not base) */
async function onWeekChange(){
  await loadWeekEdits();
  renderConsole();
  renderTable();
}

/* =======================
   Boot
======================= */
window.onload = async () => {
  const today = new Date().toISOString().slice(0,10);
  document.getElementById("wkEnd").value = today;
  document.getElementById("wkStart").value = today;

  document.getElementById("wkStart").addEventListener("change", onWeekChange);
  document.getElementById("wkEnd").addEventListener("change", onWeekChange);

  await reloadAll();
};
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Daily Diary (Logic: Office / Tour / Holiday)</title>

<style>
  :root{
    --border:#000;
    --paper:#fff;
    --bg:#eef2f6;
    --fs:11px;
    --fs2:10px;
    --pageW:1123px;
  }
  *{box-sizing:border-box}
  body{ margin:0; padding:16px; background:var(--bg); font-family:Arial,Helvetica,sans-serif; color:#111; }

  .toolbar{
    width:min(var(--pageW),100%);
    margin:0 auto 10px auto;
    display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center;
  }
  .left-tools{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .btn{
    border:1px solid #c9d3df; background:#fff;
    padding:8px 12px; border-radius:10px; cursor:pointer;
    font-weight:800; font-size:13px;
  }
  .hint{ font-size:12px; color:#334155; }

  .paper{
    width: var(--pageW);
    background:var(--paper);
    margin:0 auto 18px auto;
    border:1px solid #c9d3df;
    box-shadow:0 12px 30px rgba(0,0,0,.10);
    padding:10px;
    overflow:hidden;
  }
  .frame{ border:1px solid var(--border); padding:8px; }

  /* Header (same as your format) */
  .topline{
    display:flex; align-items:flex-end; gap:10px;
    font-weight:800; font-size:18px; margin-bottom:6px;
  }
  .dotsLong{ flex:1; border-bottom:1px dotted #000; height:14px; }
  .dots{ display:inline-block; border-bottom:1px dotted #000; min-width:120px; height:14px; vertical-align:bottom; }

  .headgrid{
    display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:10px;
    align-items:end; font-size:12px; margin-bottom:6px;
  }
  .headgrid .cell{ white-space:nowrap; }
  .hirow{ font-weight:700; }
  .schemeLine{ margin:6px 0 8px 0; font-size:12px; }

  /* Table */
  .scrollX{ overflow:auto; }
  table.diary{ width:100%; border-collapse:collapse; table-layout:fixed; font-size:var(--fs); }
  th, td{ border:1px solid var(--border); padding:2px 3px; text-align:center; vertical-align:middle; word-break:break-word; }
  thead th{ font-weight:800; }
  .group{ font-size:12px; }
  .sub{ font-size:var(--fs2); font-weight:800; }
  .colno{ font-weight:800; background:#fafafa; font-size:var(--fs2); }

  col.c1{ width:6.2%; }  /* Date/Time dep */
  col.c2{ width:6.2%; }  /* From */
  col.c3{ width:6.2%; }  /* Date/Time arr */
  col.c4{ width:6.2%; }  /* To */
  col.c5{ width:8.0%; }  /* Mode */
  col.c6{ width:7.6%; }  /* Distance */
  col.c7{ width:6.0%; }  /* Fare Rs */
  col.c8{ width:3.0%; }  /* Fare P */
  col.c9{ width:6.4%; }  /* Scheme */
  col.c10{ width:9.5%; } /* Unit name */
  col.c11{ width:14.5%; }/* Desc */
  col.c12{ width:7.5%; } /* Volume */
  col.c13{ width:7.5%; } /* Time spent */
  col.c14{ width:4.0%; } /* Days */
  col.c15{ width:4.0%; } /* Hours */
  col.c16{ width:4.4%; } /* Remarks */

  .cellIn{
    width:100%; border:none; outline:none; background:transparent;
    font-size:var(--fs); padding:1px 2px; text-align:center;
  }
  .leftText{ text-align:left; padding-left:4px; }
  .rightText{ text-align:right; padding-right:4px; }
  tbody td{ height:20px; }

  /* Day Type UI inside first cell */
  .dateCellWrap{ display:flex; flex-direction:column; gap:2px; }
  .dayType{
    width:100%;
    font-size:10px;
    padding:2px 4px;
    border:1px solid #666;
    border-radius:4px;
    background:#fff;
    font-weight:800;
  }
  .rowMuted{ background:#f4f6f8; }
  .rowHoliday{ background:#f7f7f7; }
  .disabledField{ opacity:.55; }

  /* Footer page2 */
  .page2-footer{
    margin-top:10px;
    display:grid;
    grid-template-columns: 1.2fr 1fr;
    gap:14px;
    align-items:start;
    font-size:12px;
  }
  .note{ line-height:1.3; }
  .signs{ line-height:1.7; }
  .sigLine{
    display:inline-block;
    border-bottom:1px dotted #000;
    min-width:240px;
    height:14px;
    vertical-align:bottom;
  }

  @media (max-width:1150px){ .paper{ width:100%; } }

  @media print{
    body{ background:#fff; padding:0; }
    .toolbar{ display:none; }
    .paper{ box-shadow:none; border:none; margin:0; page-break-after:always; }
    @page{ size:A4 landscape; margin:8mm; }
  }
</style>
</head>

<body>
<div class="toolbar">
  <div class="left-tools">
    <button class="btn" onclick="setAll('OFFICE')">All Office</button>
    <button class="btn" onclick="setAll('TOUR')">All Tour</button>
    <button class="btn" onclick="setAll('HOLIDAY')">All Holiday</button>
    <span class="hint">Row dropdown → auto enable/disable fields.</span>
  </div>
  <button class="btn" onclick="window.print()">Print / Save PDF</button>
</div>

<!-- ================= PAGE 1 ================= -->
<section class="paper">
  <div class="frame">
    <div class="topline">
      <span>माह</span><span class="dotsLong"></span>
      <span>202</span><span class="dots" style="min-width:40px;"></span>
      <span class="dotsLong"></span>
      <span>की दैनिक/ DAILY DIARY FOR THE MONTH OF</span>
      <span class="dotsLong"></span>
      <span>202</span><span class="dots" style="min-width:40px;"></span>
    </div>

    <div class="headgrid">
      <div class="cell hirow">क्षेत्र कर्मचारी का नाम <span class="dots" style="min-width:220px;"></span></div>
      <div class="cell hirow">पदनाम <span class="dots" style="min-width:170px;"></span></div>
      <div class="cell hirow">उ०श्रे०का/एन०श्रे०का० <span class="dots" style="min-width:170px;"></span></div>
      <div class="cell hirow">क्षेत्रीय कार्यालय <span class="dots" style="min-width:140px;"></span></div>

      <div class="cell">Name of the Field Official <span class="dots" style="min-width:180px;"></span></div>
      <div class="cell">Designation <span class="dots" style="min-width:170px;"></span></div>
      <div class="cell">S.R.O./N.S.R.O. <span class="dots" style="min-width:170px;"></span></div>
      <div class="cell">R.O. <span class="dots" style="min-width:180px;"></span></div>
    </div>

    <div class="schemeLine">
      किस स्कीम के अन्तर्गत कार्यरत (सामाजिक/कृषि/उ०श्रे०का/न०उ०श्रे०का/ अन्य)
      <br>
      Scheme in which working (SE/AS/ASI/UFS) <span class="dots" style="min-width:420px;"></span>
    </div>

    <div class="scrollX">
      <table class="diary">
        <colgroup>
          <col class="c1"><col class="c2"><col class="c3"><col class="c4"><col class="c5"><col class="c6"><col class="c7"><col class="c8">
          <col class="c9"><col class="c10"><col class="c11"><col class="c12"><col class="c13"><col class="c14"><col class="c15"><col class="c16">
        </colgroup>

        <thead>
          <tr>
            <th class="group" colspan="8">यात्रा<br>JOURNEY</th>
            <th class="group" rowspan="2">स्कीम<br>Scheme</th>
            <th class="group" colspan="3">किया गया कार्य<br>WORK DONE</th>
            <th class="group" colspan="4">विराम अवधि<br>DURATION OF HALT</th>
          </tr>
          <tr>
            <th class="sub" colspan="2">प्रस्थान<br>Departure</th>
            <th class="sub" colspan="2">आगमन<br>Arrival</th>

            <th class="sub" rowspan="2">यात्रा का साधन अथवा यात्रा की श्रेणी<br>Mode of travel of accommodation</th>
            <th class="sub" rowspan="2">सड़क द्वारा तय की गई दूरी कि.मी. for road mileage</th>

            <th class="sub" colspan="2">अदा किया गया किराया<br>Fare Paid</th>

            <th class="sub" rowspan="2">पहचान क्रम संख्या सहित प्रतिदर्श इकाई का नाम<br>Name of sample unit with identification serial number</th>
            <th class="sub" rowspan="2">किये गये कार्य का वर्णन<br>Description of work done</th>
            <th class="sub" rowspan="2">यात्रा की दृष्टि से किये गये कार्य की परिमाण<br>Volume of work done in quantitative terms</th>

            <th class="sub" rowspan="2">व्यतीत समय (घंटे-मिनट)<br>Time spent (Hrs.-Mts.)</th>
            <th class="sub" rowspan="2">दिन<br>Days</th>
            <th class="sub" rowspan="2">घंटे<br>Hours</th>
            <th class="sub" rowspan="2">अभ्युक्ति<br>Remarks</th>
          </tr>
          <tr>
            <th class="sub">दिनांक तथा समय<br>Date &amp; Time</th>
            <th class="sub">से<br>From</th>
            <th class="sub">दिनांक तथा समय<br>Date &amp; Time</th>
            <th class="sub">तक<br>To</th>
            <th class="sub">Rs.</th>
            <th class="sub">P.</th>
          </tr>
          <tr>
            <th class="colno">1</th><th class="colno">2</th><th class="colno">3</th><th class="colno">4</th>
            <th class="colno">5</th><th class="colno">6</th><th class="colno">7</th><th class="colno">8</th>
            <th class="colno">9</th><th class="colno">10</th><th class="colno">11</th><th class="colno">12</th>
            <th class="colno">13</th><th class="colno">14</th><th class="colno">15</th><th class="colno">16</th>
          </tr>
        </thead>

        <tbody id="p1Rows"></tbody>
      </table>
    </div>
  </div>
</section>

<!-- ================= PAGE 2 ================= -->
<section class="paper">
  <div class="frame">
    <div class="scrollX">
      <table class="diary">
        <colgroup>
          <col class="c1"><col class="c2"><col class="c3"><col class="c4"><col class="c5"><col class="c6"><col class="c7"><col class="c8">
          <col class="c9"><col class="c10"><col class="c11"><col class="c12"><col class="c13"><col class="c14"><col class="c15"><col class="c16">
        </colgroup>
        <thead>
          <tr>
            <th class="colno">1</th><th class="colno">2</th><th class="colno">3</th><th class="colno">4</th>
            <th class="colno">5</th><th class="colno">6</th><th class="colno">7</th><th class="colno">8</th>
            <th class="colno">9</th><th class="colno">10</th><th class="colno">11</th><th class="colno">12</th>
            <th class="colno">13</th><th class="colno">14</th><th class="colno">15</th><th class="colno">16</th>
          </tr>
        </thead>
        <tbody id="p2Rows"></tbody>
      </table>
    </div>

    <div class="page2-footer">
      <div class="note">
        <b>नोट :</b> दैनिक नियमित रूप से प्रतिदिन भरी जानी चाहिए और पूरी व ठीक-ठाक रखनी चाहिए।<br>
        <b>Note :</b> The daily diary should be filled up everyday punctually and kept up to date.
      </div>

      <div class="signs">
        सम्बन्धित क्षेत्र के कर्मचारी के हस्ताक्षर <span class="sigLine"></span><br>
        Signature of the concerned Field Official <span class="sigLine"></span><br><br>
        आसन्न पर्यवेक्षी अधिकारी के हस्ताक्षर <span class="sigLine"></span><br>
        Signature of the immediate Supervisory Officer <span class="sigLine"></span><br><br>
        प्रभारी अधिकारी के हस्ताक्षर <span class="sigLine"></span><br>
        Signature of the Officer-in-Charge <span class="sigLine"></span>
      </div>
    </div>
  </div>
</section>

<script>
  // --------- Helpers ----------
  const DAYTYPES = ["OFFICE","TOUR","HOLIDAY","LEAVE"];

  function qs(el, sel){ return el.querySelector(sel); }
  function qsa(el, sel){ return Array.from(el.querySelectorAll(sel)); }

  // Parse "HH:MM" from a string (accepts "10:30", "10.30", "1030")
  function parseTimeToMinutes(s){
    if(!s) return null;
    s = String(s).trim();
    if(!s) return null;

    // 1030 => 10:30
    if(/^\d{3,4}$/.test(s)){
      const t = s.padStart(4,"0");
      const hh = parseInt(t.slice(0,2),10);
      const mm = parseInt(t.slice(2),10);
      if(hh>=0 && hh<=23 && mm>=0 && mm<=59) return hh*60+mm;
      return null;
    }

    s = s.replace(".",":");
    const m = s.match(/^(\d{1,2}):(\d{2})$/);
    if(!m) return null;
    const hh = parseInt(m[1],10), mm = parseInt(m[2],10);
    if(hh>=0 && hh<=23 && mm>=0 && mm<=59) return hh*60+mm;
    return null;
  }

  function minutesToHrsMts(mins){
    const h = Math.floor(mins/60);
    const m = mins%60;
    return `${String(h).padStart(2,"0")}-${String(m).padStart(2,"0")}`;
  }

  // --------- Row building ----------
  function makeRow(){
    // We add DayType dropdown INSIDE column 1 (top) + date/time input (below) to avoid changing columns.
    return `
      <tr data-daytype="OFFICE">
        <!-- 1: Date & Time (Departure) + DayType -->
        <td>
          <div class="dateCellWrap">
            <select class="dayType" title="Day Type">
              ${DAYTYPES.map(t=>`<option value="${t}">${t}</option>`).join("")}
            </select>
            <input class="cellIn depDT" placeholder="Date/Time" />
          </div>
        </td>

        <!-- 2 From -->
        <td><input class="cellIn leftText from" /></td>

        <!-- 3 Date/Time Arrival -->
        <td><input class="cellIn arrDT" placeholder="Date/Time" /></td>

        <!-- 4 To -->
        <td><input class="cellIn leftText to" /></td>

        <!-- 5 Mode -->
        <td><input class="cellIn leftText mode" /></td>

        <!-- 6 Distance -->
        <td><input class="cellIn rightText dist" /></td>

        <!-- 7 Fare Rs -->
        <td><input class="cellIn rightText fareRs" /></td>

        <!-- 8 Fare P -->
        <td><input class="cellIn rightText fareP" /></td>

        <!-- 9 Scheme -->
        <td><input class="cellIn scheme" /></td>

        <!-- 10 Unit name -->
        <td><input class="cellIn leftText unit" /></td>

        <!-- 11 Description -->
        <td><input class="cellIn leftText desc" /></td>

        <!-- 12 Volume -->
        <td><input class="cellIn rightText vol" /></td>

        <!-- 13 Time spent (Hrs-Mts) -->
        <td><input class="cellIn halt" placeholder="HH-MM" /></td>

        <!-- 14 Days -->
        <td><input class="cellIn days" /></td>

        <!-- 15 Hours -->
        <td><input class="cellIn hours" /></td>

        <!-- 16 Remarks -->
        <td><input class="cellIn leftText remarks" /></td>
      </tr>
    `;
  }

  // --------- Logic rules ----------
  const FIELD_GROUPS = {
    journey: [".depDT",".from",".arrDT",".to",".mode",".dist",".fareRs",".fareP"],
    work: [".scheme",".unit",".desc",".vol",".halt",".days",".hours",".remarks"]
  };

  function setDisabled(row, selectorList, disabled){
    selectorList.forEach(sel=>{
      const el = qs(row, sel);
      if(!el) return;
      el.disabled = disabled;
      el.classList.toggle("disabledField", disabled);
      if(disabled){
        // clear invalid entries automatically (logic edit)
        if(sel !== ".remarks") el.value = "";
      }
    });
  }

  function applyDayType(row, type){
    row.dataset.daytype = type;

    // Reset row styles
    row.classList.remove("rowHoliday","rowMuted");

    if(type === "HOLIDAY" || type === "LEAVE"){
      row.classList.add("rowHoliday");
      // Disable everything
      const allInputs = qsa(row, "input, select");
      allInputs.forEach(el=>{
        if(el.classList.contains("dayType")) return; // keep dropdown
        el.disabled = true;
        el.classList.add("disabledField");
        // clear
        el.value = "";
      });
      // Set remark automatically (enabled temporarily then lock)
      const remarks = qs(row, ".remarks");
      if(remarks){
        remarks.disabled = false;
        remarks.classList.remove("disabledField");
        remarks.value = type; // auto
        remarks.disabled = true;
        remarks.classList.add("disabledField");
      }
      return;
    }

    // Enable all first (except based on rules below)
    qsa(row, "input").forEach(el=>{
      el.disabled = false;
      el.classList.remove("disabledField");
    });

    if(type === "OFFICE"){
      row.classList.add("rowMuted");
      // Office = No journey (disable journey block), work allowed
      setDisabled(row, FIELD_GROUPS.journey, true);
      setDisabled(row, FIELD_GROUPS.work, false);
      // Put hint in remarks if empty
      const rem = qs(row, ".remarks");
      if(rem && !rem.value) rem.value = "OFFICE DAY";
    }

    if(type === "TOUR"){
      // Tour = everything enabled
      setDisabled(row, FIELD_GROUPS.journey, false);
      setDisabled(row, FIELD_GROUPS.work, false);
      const rem = qs(row, ".remarks");
      if(rem && rem.value === "OFFICE DAY") rem.value = "";
    }
  }

  // Auto-calc Halt Time (Hrs-Mts) using Arrival time -> Departure time if same day:
  // If both depDT & arrDT have "HH:MM" anywhere, compute abs diff and put in halt.
  function autoCalcHalt(row){
    const type = row.dataset.daytype;
    if(type === "HOLIDAY" || type === "LEAVE") return;

    const dep = (qs(row, ".depDT")?.value || "").trim();
    const arr = (qs(row, ".arrDT")?.value || "").trim();

    // Extract time part from strings (keep last HH:MM-like token)
    const extractTimeToken = (s)=>{
      const t = s.replace(/\./g,":").match(/(\d{1,2}:\d{2}|\d{3,4})/g);
      return t ? t[t.length-1] : "";
    };

    const depTok = extractTimeToken(dep);
    const arrTok = extractTimeToken(arr);

    const depMin = parseTimeToMinutes(depTok);
    const arrMin = parseTimeToMinutes(arrTok);
    if(depMin == null || arrMin == null) return;

    let diff = arrMin - depMin;
    if(diff < 0) diff = diff + 24*60; // overnight
    // Put in halt (col 13)
    const halt = qs(row, ".halt");
    if(halt && !halt.disabled){
      halt.value = minutesToHrsMts(diff);
    }
  }

  function hookRow(row){
    // day type dropdown
    const dd = qs(row, ".dayType");
    dd.addEventListener("change", ()=>{
      applyDayType(row, dd.value);
    });

    // auto halt when times change
    ["depDT","arrDT"].forEach(cls=>{
      const el = qs(row, "."+cls);
      el.addEventListener("input", ()=> autoCalcHalt(row));
      el.addEventListener("blur", ()=> autoCalcHalt(row));
    });

    // init
    applyDayType(row, dd.value);
  }

  function setAll(type){
    document.querySelectorAll("tbody tr").forEach(tr=>{
      const dd = qs(tr, ".dayType");
      dd.value = type;
      applyDayType(tr, type);
    });
  }

  // --------- Build pages ----------
  const PAGE1_ROWS = 12;
  const PAGE2_ROWS = 18;

  function build(){
    const p1 = document.getElementById("p1Rows");
    const p2 = document.getElementById("p2Rows");
    p1.innerHTML = "";
    p2.innerHTML = "";

    for(let i=0;i<PAGE1_ROWS;i++){
      p1.insertAdjacentHTML("beforeend", makeRow());
      hookRow(p1.lastElementChild);
    }
    for(let i=0;i<PAGE2_ROWS;i++){
      p2.insertAdjacentHTML("beforeend", makeRow());
      hookRow(p2.lastElementChild);
    }
  }

  build();
</script>

</body>
</html>